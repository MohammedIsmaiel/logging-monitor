<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Logs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body class="bg-secondary badge-light">
    <div class="container mt-5 bg-secondary badge-light" style="height: 100vh;">
        <form id="logForm">
            <div id="select">
                <label for="logName">Choose a log:</label>
                <select id="logName" name="name">
                    <option value="a">Log a</option>
                    <option value="b">Log b</option>
                    <option value="c">Log c</option>
                </select>
            </div>
            <button id="submitButton" type="submit" class="btn btn-primary">show logs</button>
            <a id="homeButton" href="/logs" type="button" disabled class="btn btn-primary">reset</a>
        </form>
        <h3>Logs:</h1>
            <ul id="messageList" class="list-group list-group-flush  bg-secondary text-start badge-light">
            </ul>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"
        integrity="sha512-1QvjE7BtotQjkq8PxLeF6P46gEpBRXuskzIVgjFpekzFVF4yjRgrQvTG1MTOJ3yQgvTteKAcO7DSZI92+u/yZw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"
        integrity="sha512-iKDtgDyTHjAitUDdLljGhenhPwrbBfqTKWO1mkhSFH3A7blITC9MhYon6SjnMhp4o0rADGw9yAC6EW4t5a4K3g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        var client
        var webSocket = new SockJS('/websocket');
        client = Stomp.over(webSocket);
        const submitButton = document.getElementById('submitButton')
        const homeButton = document.getElementById('homeButton')
        const select = document.getElementById('select')

        client.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            client.subscribe('/topic/messages', function (message) {
                console.log(message.body);
                var messageList = document.getElementById('messageList');
                var listItem = document.createElement('li');
                // listItem.classList.add('list-group-item');
                listItem.classList.add('bg-secondary');
                listItem.classList.add('text-start');
                listItem.classList.add('badge');
                listItem.appendChild(document.createTextNode(message.body));
                messageList.appendChild(listItem);
            });
        });

        document.getElementById('logForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent the default form submission behavior
            // homeButton.setAttribute("disabled", 'false')
            homeButton.removeAttribute("disabled")
            submitButton.setAttribute("disabled", 'true')
            select.setAttribute('hidden', 'true')

            document.getElementById('messageList').innerHTML = "";
            // Get the selected log name from the dropdown
            var logName = document.getElementById('logName').value;

            // Build the URL for the GET request
            var url = '/logs/' + encodeURIComponent(logName);

            // Use the Fetch API to send a GET request
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    // Handle the response data as needed
                    console.log('Response:', data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });

        function connectSocket() {

        }

    </script>



</body>

</html>